"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([[64972],{564972:(e,n,t)=>{t.r(n);t.d(n,{AddPaymentModalOld:()=>ce,default:()=>pe});var r=t(785893),s=t(667294),a=t(886664),i=t(294184),o=t.n(i),l=t(791462),u=t(173436),c=t(737325),d=t(886110),p=t(976882),f=t(658350),h=t(390599),A=t(967543),y=t(40188),S=t(378564),P=t(775584),E=t(915004),b=t(842256),g=t(191940),C=t(487502),v=t(326440),m=t(562181),N=t(67416),_=t(742269),T=t(204371),O=t(185494),R=t(211862),I=t(150251),Y=t(363915),M=t(156978),D=t(472107),x=t(461061),B=t(959797),Z=t(241910),k=t.n(Z),w=t(3066),j=t.n(w);function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function F(e,n,t,r,s,a,i){try{var o=e[a](i),l=o.value}catch(e){t(e);return}o.done?n(l):Promise.resolve(l).then(r,s)}function Q(e){return function(){var n=this,t=arguments;return new Promise((function(r,s){var a=e.apply(n,t);function i(e){F(a,r,s,i,o,"next",e)}function o(e){
F(a,r,s,i,o,"throw",e)}i(void 0)}))}}function H(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function U(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1;r.configurable=!0;"value"in r&&(r.writable=!0);Object.defineProperty(e,r.key,r)}}function G(e,n,t){n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t;return e}function V(e){V=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)};return V(e)}function W(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))));r.forEach((function(n){G(e,n,t[n])}))}return e}function z(e,n){return!n||"object"!==X(n)&&"function"!=typeof n?L(e):n}function q(e,n){
q=Object.setPrototypeOf||function(e,n){e.__proto__=n;return e};return q(e,n)}var X=function(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};function K(e){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return!0}catch(e){return!1}}();return function(){var t,r=V(e);if(n){var s=V(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return z(this,t)}}var J,$=function(e,n){var t,r,s,a,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(t)throw new TypeError("Generator is already executing.");for(;i;)try{if(t=1,
r&&(s=2&a[0]?r.return:a[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,a[1])).done)return s;(r=0,s)&&(a=[2&a[0],s.value]);switch(a[0]){case 0:case 1:s=a;break;case 4:i.label++;return{value:a[1],done:!1};case 5:i.label++;r=a[1];a=[0];continue;case 7:a=i.ops.pop();i.trys.pop();continue;default:if(!(s=i.trys,s=s.length>0&&s[s.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!s||a[1]>s[0]&&a[1]<s[3])){i.label=a[1];break}if(6===a[0]&&i.label<s[1]){i.label=s[1];s=a;break}if(s&&i.label<s[2]){i.label=s[2];i.ops.push(a);break}s[2]&&i.ops.pop();i.trys.pop();continue}a=n.call(e,i)}catch(e){a=[6,e];r=0}finally{t=s=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};!function(e){e.PAYMENT_TYPE="payment_type";e.CARD_INFO="card_info";e.SOFORT_INFO="sofort_info";e.ADDRESS="billing_address";e.PAYMENT_REQUEST_INFO="payment_request_info";e.PAYPAL="paypal";e.PRZELEWY24_INFO="przelewy24_info"}(J||(J={}));function ee(e){switch(e){case J.PAYMENT_TYPE:
return B.Z.Messages.PAYMENT_SOURCE_TYPE;case J.PAYMENT_REQUEST_INFO:return B.Z.Messages.BILLING_STEP_PAYMENT_INFO;case J.CARD_INFO:return B.Z.Messages.PAYMENT_SOURCE_INFORMATION;case J.ADDRESS:return B.Z.Messages.BILLING_ADDRESS;case J.PAYPAL:return B.Z.Messages.PAYMENT_SOURCE_PAYPAL_DETAILS;case J.SOFORT_INFO:return B.Z.Messages.PAYMENT_SOURCE_SOFORT_INFO;case J.PRZELEWY24_INFO:return B.Z.Messages.PAYMENT_SOURCE_PRZELEWY24_INFO}}var ne=[J.PAYMENT_TYPE,J.CARD_INFO,J.ADDRESS],te=[J.PAYMENT_TYPE,J.SOFORT_INFO,J.ADDRESS],re=[J.PAYMENT_TYPE,J.PAYPAL,J.ADDRESS],se=[J.PAYMENT_TYPE,J.PAYMENT_REQUEST_INFO],ae=[J.PAYMENT_TYPE,J.ADDRESS],ie=[J.PAYMENT_TYPE,J.PRZELEWY24_INFO,J.ADDRESS],oe=[J.PAYMENT_TYPE,J.ADDRESS];function le(e){return e.hasCardError()?J.CARD_INFO:e.hasAddressError()?J.ADDRESS:null}var ue=function(e){!function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{
value:e,writable:!0,configurable:!0}});n&&q(e,n)}(t,e);var n=K(t);function t(){H(this,t);var e,s;(e=n.apply(this,arguments)).state={type:x.HeQ.CARD,step:J.PAYMENT_TYPE,steps:ne,errorStep:null,stripeToken:null,stripe:null,tokenSubmitting:!1,paymentDetails:{p24Bank:""}};e.STEPS_DATA=(G(s={},J.PRZELEWY24_INFO,{renderBody:function(){var n=e.props,t=n.error,s=n.billingAddressInfo;return(0,r.jsx)(Y.w,{billingAddressInfo:s,onDetailsChange:e.handlePaymentDetailsChange,onP24BankChange:e.handleP24BankChange,p24BankValue:e.state.paymentDetails.p24Bank,error:t})},renderNextButton:function(){var n,t=e.props.billingAddressInfo,s=null===(n=e.state.paymentDetails)||void 0===n?void 0:n.p24Bank;return(0,r.jsx)(g.Co,{type:"submit",disabled:""===t.name||""===t.email||""===s,onClick:e.handleNextClick,children:B.Z.Messages.NEXT})}}),G(s,J.SOFORT_INFO,{renderBody:function(){var n=e.props,t=n.error,s=n.billingAddressInfo;return(0,r.jsx)(Y.Z,{billingAddressInfo:s,onChange:e.handlePaymentDetailsChange,error:t})
},renderNextButton:function(){var n=e.props.billingAddressInfo;return(0,r.jsx)(g.Co,{type:"submit",disabled:""===n.name||""===n.email,onClick:e.handleNextClick,children:B.Z.Messages.NEXT})}}),G(s,J.PAYMENT_TYPE,{renderBody:function(){return(0,r.jsx)(R.Z,{allowStripeRequestPayments:!_.FB,onChooseType:e.handleChooseType,onStripePaymentMethodReceived:e.handleStripePaymentMethod})}}),G(s,J.PAYMENT_REQUEST_INFO,{renderBody:function(){var n=e.props,t=n.stripePaymentMethod,s=n.submitting;return(0,r.jsx)(D.k,{stripePaymentMethod:t,submitting:s})},renderNextButton:function(){var n=e.props.submitting;return(0,r.jsx)(g.Co,{submitting:n,look:g.Co.Looks.OUTLINED,disabled:!0})}}),G(s,J.CARD_INFO,{renderBody:function(){var n=e.props.error,t=null!=n&&(null==n.code||le(n)===J.CARD_INFO);return(0,r.jsxs)(r.Fragment,{children:[t?(0,r.jsx)(v.Z,{className:k().errorBlock,children:B.Z.Messages.BILLING_ERROR_SECTION_CARD}):null,(0,r.jsx)(O.Z,{onCardInfoChange:e.handleCardInfoChange,error:t?n:null})]})},
renderNextButton:function(){var n=e.props.isCreditCardInfoValid,t=e.state.tokenSubmitting;return(0,r.jsx)(a.ElementsConsumer,{children:function(s){var a=s.elements;return(0,r.jsx)(g.Co,{disabled:!n,onClick:function(){e.createToken(a)},type:"submit",submitting:t,children:B.Z.Messages.NEXT})}})}}),G(s,J.ADDRESS,{renderBody:function(){var n=e.props,t=n.billingAddressInfo,s=n.error,a=e.state.type;return(0,r.jsx)(M.P,{billingAddressInfo:t,billingError:s,onBillingAddressChange:e.handleBillingAddressChange,paymentSourceType:a})},renderNextButton:function(){var n=e.props,t=n.submitting,s=n.isBillingAddressInfoValid,a=n.isAuthenticating;return(0,r.jsx)(g.Co,{type:"submit",submitting:t,disabled:!s||a,onClick:e.handleSave,children:B.Z.Messages.SAVE})}}),G(s,J.PAYPAL,{renderBody:function(){return(0,r.jsx)(I.Z,{})},renderNextButton:function(){var n=e.props,t=n.submitting,s=n.braintreeNonce,a=null!=n.braintreeEmail&&null!=s;return(0,r.jsx)(g.Co,{submitting:t,
color:a?g.Co.Colors.BRAND:g.Co.Colors.PRIMARY,onClick:a?e.handleNextClick:e.handleReopenPaypal,children:a?B.Z.Messages.NEXT:B.Z.Messages.PAYMENT_SOURCE_CONNECT_TO_PAYPAL})}}),s);e.handleChooseType=function(n){var t=e.getSteps(n),r=e.getNextStep(t);null!=r&&e.setState({type:n,steps:t,step:r})};e.handleCardInfoChange=function(e,n){u.Z.wait((function(){return(0,p.sn)(e,n)}))};e.handlePaymentDetailsChange=function(n){var t=e.props.billingAddressInfo;t.name=n.name;u.Z.wait((function(){return(0,p.Ow)(W({},t,n),!1)}))};e.handleP24BankChange=function(n){e.setState({paymentDetails:{p24Bank:n}})};e.handleBillingAddressChange=function(n,t){var r=e.props.billingAddressInfo;u.Z.wait((function(){return(0,p.Ow)(W({},r,n),t)}))};e.handleBackClick=function(){var n=e.getPreviousStep();if(null!=n){n===J.PAYMENT_TYPE&&(0,p.fw)();e.setState({step:n})}};e.handleNextClick=function(){var n=e.getNextStep();null!=n&&e.setState({step:n})};e.handleClose=function(){(0,p.fw)();e.props.onClose()}
;e.handleStripePaymentMethod=function(n){(0,p.Xt)(n);null!=n?e.handleStripePaymentRequestSave(n):e.handleBackClick()};var i,o=L(e);e.handleStripePaymentRequestSave=(i=Q((function(e){var n,t;return $(this,(function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,c.i6(e,void 0,o.props.analyticsLocation)];case 1:n=r.sent();null==(t=o.props.onAddPaymentSource)||t(n);o.handleClose();return[3,3];case 2:r.sent();return[3,3];case 3:return[2]}}))})),function(e){return i.apply(this,arguments)});var l=L(e);e.createToken=function(){var e=Q((function(e){var n,t;return $(this,(function(r){switch(r.label){case 0:n=l.state.stripe;l.setState({tokenSubmitting:!0});r.label=1;case 1:r.trys.push([1,3,4,5]);return[4,c.qv(n,e)];case 2:t=r.sent();l.setState({stripeToken:t});l.handleNextClick();return[3,5];case 3:r.sent();return[3,5];case 4:l.setState({tokenSubmitting:!1});return[7];case 5:return[2]}}))}));return function(n){return e.apply(this,arguments)}}();e.handleSave=function(){var n=e.state.type
;switch(n){case x.HeQ.PAYPAL:return e.handlePaypalSave();case x.HeQ.CARD:return e.handleCardSave();case x.HeQ.SOFORT:return e.handleSofortSave();case x.HeQ.GIROPAY:return e.handleGiropaySave();case x.HeQ.PRZELEWY24:return e.handlePrzelewy24Save();case x.HeQ.PAYSAFE_CARD:case x.HeQ.GRABPAY_MY:return e.handleAdyenPrepaidPaymentMethodSave(n);default:c.SQ("user used a unsupported payment type: ".concat(n))}};var d=L(e);e.handlePrzelewy24Save=Q((function(){var e,n,t,r,s,a,i,o,l;return $(this,(function(u){switch(u.label){case 0:e=d.props,n=e.billingAddressInfo,t=e.isBillingAddressInfoValid,r=e.onAddPaymentSource,s=e.analyticsLocation;a=d.state,i=a.stripe,o=a.paymentDetails;if(!t)return[2];u.label=1;case 1:u.trys.push([1,3,,4]);return[4,c.pF(i,o,n,s)];case 2:l=u.sent();null==r||r(l);d.handleClose();return[3,4];case 3:u.sent();return[3,4];case 4:return[2]}}))}));var f=L(e);e.handleSofortSave=Q((function(){var e,n,t,r,s,a,i;return $(this,(function(o){switch(o.label){case 0:e=f.props,
n=e.billingAddressInfo,t=e.isBillingAddressInfoValid,r=e.onAddPaymentSource,s=e.analyticsLocation;a=f.state.stripe;if(!t)return[2];o.label=1;case 1:o.trys.push([1,3,,4]);return[4,c.av(a,n,s)];case 2:i=o.sent();null==r||r(i);f.handleClose();return[3,4];case 3:o.sent();return[3,4];case 4:return[2]}}))}));var h=L(e);e.handleCardSave=Q((function(){var e,n,t,r,s,a,i,o,l,u;return $(this,(function(d){switch(d.label){case 0:e=h.props,n=e.billingAddressInfo,t=e.isCreditCardInfoValid,r=e.isBillingAddressInfoValid,s=e.onAddPaymentSource,a=e.analyticsLocation;i=h.state,o=i.stripe,l=i.stripeToken;if(!t||!r)return[2];d.label=1;case 1:d.trys.push([1,3,,4]);return[4,c.f0(o,l,n,a)];case 2:u=d.sent();null==s||s(u);h.handleClose();return[3,4];case 3:d.sent();return[3,4];case 4:return[2]}}))}));var A=L(e);e.handlePaypalSave=Q((function(){var e,n,t,r,s,a,i;return $(this,(function(o){switch(o.label){case 0:e=A.props,n=e.braintreeEmail,t=e.braintreeNonce,r=e.billingAddressInfo,s=e.onAddPaymentSource,
a=e.analyticsLocation;if(null==n||null==t)return[3,4];o.label=1;case 1:o.trys.push([1,3,,4]);return[4,c.lP(t,r,a)];case 2:i=o.sent();null==s||s(i);A.handleClose();return[3,4];case 3:o.sent();return[3,4];case 4:return[2]}}))}));var y=L(e);e.handleAdyenPrepaidPaymentMethodSave=function(){var e=Q((function(e){var n,t,r,s,a,i;return $(this,(function(o){switch(o.label){case 0:n=y.props,t=n.billingAddressInfo,r=n.isBillingAddressInfoValid,s=n.onAddPaymentSource,a=n.analyticsLocation;if(!r)return[2];o.label=1;case 1:o.trys.push([1,3,,4]);return[4,c.sF(t,e,a)];case 2:i=o.sent();null==s||s(i);y.handleClose();return[3,4];case 3:o.sent();return[3,4];case 4:return[2]}}))}));return function(n){return e.apply(this,arguments)}}();var S=L(e);e.handleGiropaySave=Q((function(){var e,n,t,r,s,a,i;return $(this,(function(o){switch(o.label){case 0:e=S.props,n=e.billingAddressInfo,t=e.isBillingAddressInfoValid,r=e.onAddPaymentSource,s=e.analyticsLocation;a=S.state.stripe;if(!t)return[2];o.label=1;case 1:
o.trys.push([1,3,,4]);return[4,c.GV(a,n,x.HeQ.GIROPAY,s)];case 2:i=o.sent();null==r||r(i);S.handleClose();return[3,4];case 3:o.sent();return[3,4];case 4:return[2]}}))}));return e}var s=t.prototype;s.componentDidMount=function(){var e=this;return Q((function(){var n;return $(this,(function(t){switch(t.label){case 0:d.eI();return[4,(0,T.d2)()];case 1:n=t.sent();e.setState({stripe:n});return[2]}}))}))()};s.componentWillUnmount=function(){u.Z.wait((function(){return d.cx()}));(0,p.tt)()};s.getSteps=function(e){switch(null!=e?e:this.state.type){case x.HeQ.PAYMENT_REQUEST:return se;case x.HeQ.PAYPAL:return re;case x.HeQ.SOFORT:return te;case x.HeQ.GIROPAY:return ae;case x.HeQ.PRZELEWY24:return ie;case x.HeQ.PAYSAFE_CARD:case x.HeQ.GCASH:case x.HeQ.GRABPAY_MY:case x.HeQ.MOMO_WALLET:case x.HeQ.KAKAOPAY:case x.HeQ.GOPAY_WALLET:return oe;default:return ne}};s.getNextStep=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.steps,n=this.state.step,t=e.indexOf(n)
;return e[t+1]};s.getPreviousStep=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.steps,n=this.state.step,t=e.indexOf(n);return e[t-1]};s.preventDefault=function(e){e.preventDefault()};s.handleReopenPaypal=function(){d.i0()};s.renderGenericError=function(){var e=this.props.error;return null==e||null!=le(e)?null:(0,r.jsx)(v.Z,{className:k().errorBlock,children:e.message})};s.renderFooter=function(){var e=this.stepData;return null==e.renderNextButton?null:(0,r.jsx)(N.mz,{children:(0,r.jsxs)(C.Z,{justify:C.Z.Justify.BETWEEN,children:[(0,r.jsx)(g.Co,{onClick:this.handleBackClick,color:g.Co.Colors.PRIMARY,look:g.Co.Looks.LINK,size:g.Co.Sizes.MIN,children:B.Z.Messages.BACK}),e.renderNextButton()]})})};s.render=function(){var e=this.state,n=e.step,t=e.steps,s=this.props.transitionState,i=t.map((function(e){return{id:e,label:ee(e)}}));return(0,r.jsx)(a.Elements,{options:x.OBo,stripe:this.state.stripe,children:(0,r.jsx)(N.Y0,{transitionState:s,size:N.Cg.SMALL,
className:k().modal,"aria-label":B.Z.Messages.PAYMENT_SOURCES_ADD,children:(0,r.jsxs)("form",{className:k().form,onSubmit:this.preventDefault,children:[(0,r.jsxs)(N.xB,{direction:C.Z.Direction.VERTICAL,align:C.Z.Align.STRETCH,separator:!1,children:[(0,r.jsxs)(C.Z,{className:k().modalTitle,justify:C.Z.Justify.BETWEEN,align:C.Z.Align.CENTER,children:[(0,r.jsx)(m.vw,{tag:m.RB.H4,children:B.Z.Messages.PAYMENT_SOURCES_ADD}),(0,r.jsx)(N.ol,{onClick:this.handleClose})]}),this.renderGenericError(),(0,r.jsx)(b.Z,{breadcrumbs:i,activeId:n})]}),(0,r.jsx)("div",{className:k().divider}),(0,r.jsx)(y.Z,{fillParent:!0,className:k().sequencer,step:n,steps:t,children:(0,r.jsx)(N.hz,{className:k().content,children:this.stepData.renderBody()})}),this.renderFooter()]})})})};t.getDerivedStateFromProps=function(e,n){var t=e.error,r=n.errorStep;if(null==t)return null==r?null:{errorStep:null};var s=le(t);return null!=s&&s!==n.errorStep?{step:s,errorStep:s}:null};!function(e,n,t){n&&U(e.prototype,n);t&&U(e,t)
}(t,[{key:"stepData",get:function(){var e=this.state.step,n=this.STEPS_DATA[e];if(null==n)throw new Error("Invalid step ".concat(e));return n}}]);return t}(s.PureComponent),ce=l.ZP.connectStores([P.Z,S.Z,E.Z],(function(){return{braintreeEmail:P.Z.braintreeEmail,braintreeNonce:P.Z.braintreeNonce,stripePaymentMethod:P.Z.stripePaymentMethod,creditCardInfo:P.Z.getCreditCardInfo(),isCreditCardInfoValid:P.Z.isCardInfoValid,billingAddressInfo:P.Z.getBillingAddressInfo(),isBillingAddressInfoValid:P.Z.isBillingAddressInfoValid,error:P.Z.error,popupCallbackCalled:P.Z.popupCallbackCalled,submitting:S.Z.isBusy,isAuthenticating:E.Z.isAwaitingAuthentication}}))(ue);function de(e){var n=e.transitionState,t=e.analyticsLocation,s=e.onClose,a=e.onAddPaymentSource,i=(0,A.fL)(),l=(0,A.vP)({paymentModalArgs:i,initialStep:h.h8.PAYMENT_TYPE,prependSteps:[],appendSteps:[],onReturn:function(){s()},onComplete:function(e,n){null==a||a(n);s()},onStepChange:function(){},header:(0,r.jsxs)("div",{
className:o()(k().modalTitle,j().flex,j().justifyBetween,j().alignCenter),children:[(0,r.jsx)(m.vw,{tag:m.RB.H4,children:B.Z.Messages.PAYMENT_SOURCES_ADD}),(0,r.jsx)(N.ol,{onClick:s})]}),analyticsLocation:t,hideBreadcrumbs:!0});return(0,r.jsx)(N.Y0,{transitionState:n,size:N.Cg.SMALL,className:k().modal,"aria-label":B.Z.Messages.PAYMENT_SOURCES_ADD,children:(0,r.jsx)("form",{className:k().form,onSubmit:function(e){e.preventDefault()},children:l})})}function pe(e){return(0,r.jsx)(f.PaymentContextProvider,{activeSubscription:null,stepConfigs:[],skuIDs:[],children:(0,r.jsx)(de,W({},e))})}}}]);
//# sourceMappingURL=9bdaa540d9f525db4dfe.js.map