"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([[22852],{122852:(e,t,n)=>{n.r(t);n.d(t,{default:()=>O});var r=n(785893),i=n(667294),a=n(496486),o=n(859169),u=n(64833),c=n(896378),l=n(546418),s=n(191940),h=n(476213),f=n(562181),d=n(911016),p=n(67416),y=n(932847),g=n(204660);function w(){return n.e(5522).then(n.bind(n,305522))}var v=n(476154),A=n(461061),b=n(271606),m=n(959797),C=n(766649),x=n.n(C);function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function L(e,t,n,r,i,a,o){try{var u=e[a](o),c=u.value}catch(e){n(e);return}u.done?t(c):Promise.resolve(c).then(r,i)}function R(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){
return Object.getOwnPropertyDescriptor(n,e).enumerable}))));r.forEach((function(t){R(e,t,n[t])}))}return e}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,a=[],o=!0,u=!1;try{for(n=n.call(e);!(o=(r=n.next()).done);o=!0){a.push(r.value);if(t&&a.length===t)break}}catch(e){u=!0;i=e}finally{try{o||null==n.return||n.return()}finally{if(u)throw i}}return a}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var M=function(e,t){
var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;(r=0,i)&&(a=[2&a[0],i.value]);switch(a[0]){case 0:case 1:i=a;break;case 4:o.label++;return{value:a[1],done:!1};case 5:o.label++;r=a[1];a=[0];continue;case 7:a=o.ops.pop();o.trys.pop();continue;default:if(!(i=o.trys,i=i.length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1];i=a;break}if(i&&o.label<i[2]){o.label=i[2];o.ops.push(a);break}i[2]&&o.ops.pop();o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e];r=0}finally{n=i=0}if(5&a[0])throw a[1]
;return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};const O=function(e){var t=e.file,n=e.imgURI,C=e.transitionState,E=e.allowSkip,R=void 0!==E&&E,O=e.onCrop,P=e.onClose,S=e.uploadType,N=void 0===S?v.pC.AVATAR:S,k=e.showUpsellHeader,I=void 0!==k&&k,D=e.analyticsPage,T=j(i.useState({width:0,height:0}),2),V=T[0],U=T[1],Z=j(i.useState({top:0,bottom:0,left:0,right:0}),2),B=Z[0],G=Z[1],z=j(i.useState(!1),2),H=z[0],Y=z[1],F=j(i.useState(1),2),K=F[0],X=F[1],$=j(i.useState({x:0,y:0}),2),q=$[0],W=$[1],J=j(i.useState(null),2),Q=J[0],ee=J[1],te=j(i.useState(!1),2),ne=te[0],re=te[1],ie=(0,u.Z)(o.Z.IMAGE_CROPPING_MODAL).AnalyticsLocationProvider,ae=(0,l.Z)().canViewThemes,oe=i.useRef({x:0,y:0}),ue=i.useRef(null),ce=i.useRef(null),le="image/gif"===t.type;i.useEffect((function(){w()}),[]);i.useEffect((function(){le&&I&&y.default.track(A.rMx.OPEN_MODAL,{type:A.jXE.CROP_GIF_MODAL,location:{page:D}})}),[I,D,le]);var se,he,fe=function(){switch(N){case v.pC.BANNER:return{height:v.f,width:v.L0}
;case v.pC.BANNER_V2:return{height:v.rK,width:v.xO};case v.pC.VIDEO_BACKGROUND:return b.HE;case v.pC.AVATAR:return{height:A.dGM,width:A.dGM};case v.pC.GUILD_BANNER:return{height:v._T,width:v.X_};case v.pC.SCHEDULED_EVENT_IMAGE:return{height:v.xT,width:v.d6};case v.pC.HOME_HEADER:return{height:v.Uo,width:v.N8}}},de=i.useCallback((function(e,t,n){oe.current=(0,g.U$)(e,t,n);null!=ue.current&&(ue.current.style.transform="translate3d(".concat(oe.current.x,"px, ").concat(oe.current.y,"px, 0)"))}),[ue]),pe=i.useCallback((function(){if(!(null==ue.current||K>1)){var e=ue.current.getBoundingClientRect(),t=e.width,n=e.height,r=(0,g.Es)(N,t,n),i=r.width,a=r.height,o=(0,g.AK)(N,i,a,n);ee({width:i,height:a});U(o);G((0,g.kH)(i,a,o))}}),[N,K]),ye=i.useCallback((function(e){var t=oe.current,n=t.x,r=t.y;if(H&&(e.clientX!==n||e.clientY!==r)){var i=e.clientX-q.x,a=e.clientY-q.y;de(i,a,B)}}),[B,H,q,de]),ge=function(){Y(!1)},we=(he=(se=function(){var e,n,r,i,a,o,u;return M(this,(function(c){switch(c.label){
case 0:if(null==ue.current)return[2];re(!0);e=ue.current;n=fe();if(!le)return[3,6];c.label=1;case 1:c.trys.push([1,4,,5]);return[4,(0,g.$p)(t,e,V,oe.current,n)];case 2:i=c.sent(),a=i.result,o=i.cancelFn;ce.current=o;return[4,a];case 3:r=c.sent();ce.current=null;return[3,5];case 4:c.sent();null===(u=ce.current)||void 0===u||u.call(ce);ce.current=null;throw Error("Error cropping GIF");case 5:return[3,7];case 6:r=(0,g.PT)(e,V,oe.current,n);c.label=7;case 7:return[4,O(r,t)];case 8:c.sent();re(!1);P();return[2]}}))},function(){var e=this,t=arguments;return new Promise((function(n,r){var i=se.apply(e,t);function a(e){L(i,n,r,a,o,"next",e)}function o(e){L(i,n,r,a,o,"throw",e)}a(void 0)}))}),function(){return he.apply(this,arguments)});i.useEffect((function(){window.addEventListener("mouseup",ge);window.addEventListener("resize",pe);return function(){window.removeEventListener("mouseup",ge);window.removeEventListener("resize",pe)}}),[pe]);i.useEffect((function(){return function(){
null!=ce.current&&ce.current()}}),[]);i.useEffect((function(){if(H){window.addEventListener("mousemove",ye);return function(){return window.removeEventListener("mousemove",ye)}}}),[ye,H]);return(0,r.jsx)(ie,{children:(0,r.jsxs)(p.Y0,{onAnimationEnd:pe,transitionState:C,size:p.Cg.MEDIUM,children:[I&&(0,r.jsx)(c.Z,{type:N,analyticsPage:D,analyticsSection:A.jXE.CROP_GIF_MODAL,isGIF:le,banner:n}),(0,r.jsx)(p.xB,{separator:!1,children:(0,r.jsx)(f.vw,{className:x().titleCase,tag:f.RB.H1,children:m.Z.Messages.AVATAR_UPLOAD_EDIT_MEDIA})}),(0,r.jsxs)(p.hz,{className:x().modalContent,children:[(0,r.jsxs)("div",{className:x().editingContainer,children:[(0,r.jsx)("img",{style:_({opacity:null==Q?0:1,transform:"translate3d(".concat(oe.current.x,"px, ").concat(oe.current.y,"px, 0px)")},function(){if(null==Q)return{};var e,t=ae?v.U9:v.MY,n=Q.width/Q.height,r=(e=fe()).width!==e.height&&n>t?V.height/Q.height:1;return{width:Q.width*K*r,minWidth:Q.width*K*r,height:Q.height*K*r}}()),
className:ne?x().imageDisabled:x().imageEnabled,src:n,alt:"avatar",ref:ue,onMouseDown:function(e){var t=e.clientX-oe.current.x,n=e.clientY-oe.current.y;W({x:t,y:n});Y(!0)},draggable:!1}),(0,r.jsx)("div",{className:N===v.pC.AVATAR?x().overlayAvatar:x().overlayBanner,style:{opacity:null==Q?0:1,width:V.width,height:V.height}})]}),(0,r.jsxs)("div",{className:x().sliderContainer,children:[(0,r.jsx)(d.Z,{className:x().icon,width:24,height:24}),(0,r.jsx)(h.Z,{initialValue:1,minValue:1,maxValue:2,keyboardStep:.025,asValueChanges:function(e){if(null!=Q){var t=Q.width,n=Q.height,r=(0,g.kH)(t*e,n*e,V),i=oe.current,o=i.x,u=i.y;(0,a.inRange)(o,r.right,r.left)&&(0,a.inRange)(u,r.top,r.bottom)||de(o,u,r);X(e);G(r)}},disabled:ne,equidistant:!0,hideBubble:!0,"aria-label":m.Z.Messages.FORM_LABEL_AVATAR_SIZE}),(0,r.jsx)(d.Z,{className:x().icon,width:48,height:48})]})]}),(0,r.jsxs)(p.mz,{className:x().modalFooter,children:[R?(0,r.jsx)(s.Co,{className:x().cancelButton,look:s.Co.Looks.LINK,
color:s.Co.Colors.PRIMARY,size:s.Ph.SMALL,onClick:function(){if(R){O(n,t);P()}},children:m.Z.Messages.AVATAR_UPLOAD_SKIP}):null,(0,r.jsxs)("div",{className:x().buttonsRight,children:[(0,r.jsx)(s.Co,{className:x().cancelButton,look:s.Co.Looks.LINK,color:s.Co.Colors.PRIMARY,size:s.Ph.SMALL,onClick:function(){if(null==ce.current)P();else{ce.current();ce.current=null;re(!1)}},children:m.Z.Messages.AVATAR_UPLOAD_CANCEL}),(0,r.jsx)(s.Co,{submitting:ne,size:s.Ph.SMALL,onClick:we,children:m.Z.Messages.AVATAR_UPLOAD_APPLY})]})]})]})})}}}]);
//# sourceMappingURL=045feb5130ec390e8779.js.map