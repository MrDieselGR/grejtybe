"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([[64634],{164634:(e,t,n)=>{n.r(t);n.d(t,{Steps:()=>G,default:()=>te});var r=n(785893),a=n(667294),s=n(294184),o=n.n(s),i=n(441143),l=n.n(i),u=n(791462),c=n(737325),p=n(952013),E=n(859169),_=n(64833),d=n(155208),f=n(916957),m=n(191940),C=n(487502),I=n(326440),y=n(82961),M=n(562181),N=n(67416),L=n(897576),h=n(932847),T=n(95467),R=n(590483),A=n(56435),P=n(212658),b=n(939042),O=n(29005),v=n(125313),S=n(112508),g=n(259083),Z=n(279480),w=n(298716),x=n(461061),j=n(959797),U=n(426296),k=n.n(U);function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function B(e,t,n,r,a,s,o){try{var i=e[s](o),l=i.value}catch(e){n(e);return}i.done?t(l):Promise.resolve(l).then(r,a)}function Y(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function o(e){B(s,r,a,o,i,"next",e)}function i(e){B(s,r,a,o,i,"throw",e)}o(void 0)}))}}
function W(e,t,n){t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n;return e}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))));r.forEach((function(t){W(e,t,n[t])}))}return e}function F(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,s=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done);o=!0){s.push(r.value);if(t&&s.length===t)break}}catch(e){i=!0;a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1)
;"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return D(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var G,K,V=function(e,t){var n,r,a,s,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;(r=0,a)&&(s=[2&s[0],a.value]);switch(s[0]){case 0:case 1:a=s;break;case 4:o.label++;return{value:s[1],done:!1};case 5:o.label++;r=s[1];s=[0];continue;case 7:
s=o.ops.pop();o.trys.pop();continue;default:if(!(a=o.trys,a=a.length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1];a=s;break}if(a&&o.label<a[2]){o.label=a[2];o.ops.push(s);break}a[2]&&o.ops.pop();o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e];r=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}};!function(e){e[e.WHAT_YOU_LOSE=1]="WHAT_YOU_LOSE";e[e.CONFIRM=2]="CONFIRM";e[e.PREVIEW=3]="PREVIEW"}(G||(G={}));function z(e){return J.apply(this,arguments)}function J(){return(J=Y((function(e){var t,n,r,a,s,o,i,l,u,p;return V(this,(function(E){switch(E.label){case 0:t=e.premiumSubscription,n=e.onClose,r=e.setHasError,a=e.setIsCancelling,s=e.analyticsLocations,o=e.analyticsLocation;E.label=1;case 1:E.trys.push([1,6,,7]);a(!0);r(!1);return t.status!==x.O0b.PAST_DUE?[3,3]:[4,(0,c.EO)(t.id,s,o)];case 2:E.sent();return[3,5];case 3:
u=null!==(l=null===(i=t.renewalMutations)||void 0===i?void 0:i.items)&&void 0!==l?l:t.items;return[4,(0,c.Mg)(t,{items:(0,R.Ue)(u)},s,o)];case 4:E.sent();E.label=5;case 5:n();null!=(p=R.ZP.getPremiumType(t.planId))&&ne({premiumType:p});return[3,7];case 6:E.sent();r(!0);a(!1);return[3,7];case 7:return[2]}}))}))).apply(this,arguments)}function X(e){var t,n=e.premiumSubscription,s=e.premiumType,o=e.setStep,i=e.onClose,l=e.whatYouLoseExperienceEnabled,u=e.analyticsLocation,c=(0,d.Q)(),E=F(a.useState(!1),2),f=E[0],y=E[1],L=F(a.useState(!1),2),h=L[0],A=L[1],P=(0,p.ZP)(),b=(0,_.Z)().analyticsLocations,O=null;O=n.status===x.O0b.PAST_DUE?j.Z.Messages.PREMIUM_CANCEL_PAST_DUE_CONFIRM_BODY:s===w.p9.TIER_0?c?j.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_0_PAYMENT_BLOCKED_RUSSIA.format({date:n.currentPeriodEnd,helpdeskArticle:T.Z.getArticleURL(x.BhN.BLOCKED_PAYMENTS)}):j.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_0.format({date:n.currentPeriodEnd
}):s===w.p9.TIER_1?c?j.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_1_PAYMENT_BLOCKED_RUSSIA.format({date:n.currentPeriodEnd,helpdeskArticle:T.Z.getArticleURL(x.BhN.BLOCKED_PAYMENTS)}):j.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_1.format({date:n.currentPeriodEnd}):c?j.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_2_PAYMENT_BLOCKED_RUSSIA.format({date:n.currentPeriodEnd,helpdeskArticle:T.Z.getArticleURL(x.BhN.BLOCKED_PAYMENTS)}):j.Z.Messages.PREMIUM_CANCEL_CONFIRM_BODY_TIER_2.format({date:n.currentPeriodEnd});var v=n.items.some((function(e){var t=e.planId;return!w.dJ.has(t)})),S=v&&null==n.renewalMutations||null!=(null===(t=n.renewalMutations)||void 0===t?void 0:t.items.find((function(e){var t=e.planId;return!w.dJ.has(t)}))),Z=S?(0,r.jsx)(m.Co,{onClick:function(){return o(G.PREVIEW)},children:j.Z.Messages.NEXT}):(0,r.jsx)(m.Co,{color:m.Co.Colors.RED,disabled:f,onClick:Y((function(){return V(this,(function(e){switch(e.label){case 0:return[4,z({setHasError:A,onClose:i,
premiumSubscription:n,setIsCancelling:y,analyticsLocations:b,analyticsLocation:u})];case 1:e.sent();return[2]}}))})),children:l?j.Z.Messages.CONFIRM:j.Z.Messages.PREMIUM_CANCEL_CONFIRM_NEW.format({planPremiumType:R.ZP.getDisplayPremiumType(n.planId)})}),U=(0,r.jsx)(m.Co,{look:m.Co.Looks.LINK,color:P===x.BRd.LIGHT?m.Co.Colors.PRIMARY:m.Co.Colors.WHITE,onClick:i,children:l?j.Z.Messages.PREMIUM_CANCEL_WHAT_YOU_LOSE_BACK:j.Z.Messages.CANCEL});return(0,r.jsxs)(r.Fragment,{children:[l?(0,r.jsx)(g.Z,{premiumType:s,className:k().cancellationHeader,onClose:i}):(0,r.jsxs)(N.xB,{separator:!1,children:[(0,r.jsx)(M.vw,{tag:M.RB.H4,children:j.Z.Messages.PREMIUM_CANCEL_CONFIRM_TITLE.format({planPremiumType:R.ZP.getDisplayPremiumType(n.planId)})}),(0,r.jsx)(N.ol,{onClick:i})]}),(0,r.jsxs)(N.hz,{className:k().body,children:[h?(0,r.jsx)(I.Z,{className:k().errorBlock,children:j.Z.Messages.BILLING_ERROR_GENERIC}):null,(0,r.jsx)("div",{className:k().cancelImage}),(0,r.jsx)("div",{children:O})]}),(0,
r.jsxs)(N.mz,{justify:C.Z.Justify.START,children:[Z,U]})]})}function $(e){var t,n,a=e.premiumSubscription,s=F((0,P.ED)({subscriptionId:a.id,items:(0,R.Ue)(null!==(n=null===(t=a.renewalMutations)||void 0===t?void 0:t.items)&&void 0!==n?n:a.items),renewal:!0}),1)[0],o=(0,u.e7)([f.Z],(function(){return f.Z.get(a.planId)}));if(null==s||null==o)return(0,r.jsx)(y.Z,{className:k().loading});var i=R.ZP.getIntervalForInvoice(s),l=i.intervalType,c=i.intervalCount;return(0,r.jsxs)("div",{className:k().bodyText,children:[(0,r.jsx)("div",{className:k().renewalInvoiceDate,children:0!==s.total?j.Z.Messages.BILLING_SWITCH_PLAN_CHANGE_DATE_WITH_CHARGE.format({renewalDate:s.subscriptionPeriodStart,rate:(0,A.og)((0,A.T4)(s.total,s.currency),l,c)}):j.Z.Messages.BILLING_SWITCH_PLAN_CHANGE_DATE.format({renewalDate:s.subscriptionPeriodStart})}),(0,r.jsxs)(b.PO,{children:[(0,r.jsx)(b.q9,{children:j.Z.Messages.PREMIUM_SUBSCRIPTION_UPDATES}),(0,r.jsx)(b.R$,{
label:j.Z.Messages.PREMIUM_SUBSCRIPTION_CANCELLED.format({planName:R.ZP.getDisplayName(o.id)}),value:(0,R.PK)(o),className:k().invoiceCancelRow}),(0,r.jsx)(b.KU,{}),(0,r.jsx)(S.nd,{premiumSubscription:a,renewalInvoice:s,isUpdate:!0})]})]})}function q(e){var t=e.premiumSubscription,n=e.premiumType,s=e.onBack,i=e.onClose,l=e.analyticsLocation,u=F(a.useState(!1),2),c=u[0],p=u[1],E=F(a.useState(!1),2),d=E[0],f=E[1],y=(0,_.Z)().analyticsLocations;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(g.Z,{premiumType:n,onClose:i}),(0,r.jsxs)(N.hz,{className:o()(k().previewStep,k().body),children:[d?(0,r.jsx)(I.Z,{className:k().errorBlock,children:j.Z.Messages.BILLING_ERROR_GENERIC}):null,(0,r.jsx)($,{premiumSubscription:t})]}),(0,r.jsxs)(N.mz,{align:C.Z.Align.CENTER,justify:C.Z.Justify.BETWEEN,children:[(0,r.jsx)(m.Co,{color:m.Co.Colors.RED,disabled:c,onClick:Y((function(){return V(this,(function(e){switch(e.label){case 0:return[4,z({setHasError:f,onClose:i,premiumSubscription:t,
setIsCancelling:p,analyticsLocations:y,analyticsLocation:l})];case 1:e.sent();return[2]}}))})),children:j.Z.Messages.PREMIUM_CANCEL_CONFIRM_NEW.format({planPremiumType:R.ZP.getDisplayPremiumType(t.planId)})}),(0,r.jsx)(v.Z,{onClick:s})]})]})}function Q(e){var t;return{subscription_id:e.id,subscription_type:e.type,subscription_plan_id:null===(t=(0,R.Af)(e))||void 0===t?void 0:t.id,subscription_plan_gateway_plan_id:e.paymentGatewayPlanId}}var ee=(W(K={},G.WHAT_YOU_LOSE,"What You're Losing"),W(K,G.CONFIRM,"Confirm Cancellation"),W(K,G.PREVIEW,"Preview Updated Subscription"),K);function te(e){var t,n=e.premiumSubscription,s=e.transitionState,o=e.onClose,i=e.analyticsLocations,u=e.analyticsLocation,c=null===(t=(0,R.Af)(n))||void 0===t?void 0:t.planId,d=null!=c?R.ZP.getPremiumType(c):null;l()(null!=d,"Should not be cancelling Premium without premiumType");var f=(0,p.ZP)();a.useEffect((function(){h.default.track(x.rMx.CANCELLATION_FLOW_STARTED,Q(n))}),[n])
;var C=d===w.p9.TIER_0||d===w.p9.TIER_1||d===w.p9.TIER_2,I=C?G.WHAT_YOU_LOSE:G.CONFIRM,y=(0,_.Z)(i,E.Z.PREMIUM_SUBSCRIPTION_CANCELLATION_MODAL).AnalyticsLocationProvider,M=F(function(e,t,n){var r=F(a.useState(e),2),s=r[0],o=r[1],i=F(a.useState(Date.now()),2),l=i[0],u=i[1],c=F(a.useState(Date.now()),1)[0],p=a.useCallback((function(e){h.default.track(x.rMx.CANCELLATION_FLOW_STEP,H({from_step:ee[s],to_step:ee[e],step_duration_ms:Date.now()-l,flow_duration_ms:Date.now()-c,location_stack:n},Q(t)));o(e);u(Date.now())}),[n,c,l,s,t]);return[s,p,l,c]}(I,n,i),4),L=M[0],T=M[1],A=M[2],P=M[3];(0,Z.w)(n,o,!1);var b,v=function(e){o();h.default.track(x.rMx.CANCELLATION_FLOW_STEP,H({from_step:ee[e],to_step:null,step_duration_ms:Date.now()-A,flow_duration_ms:Date.now()-P,location_stack:i},Q(n)))};switch(L){case G.WHAT_YOU_LOSE:b=(0,r.jsx)(O.Z,{premiumType:d,titleText:j.Z.Messages.PREMIUM_CANCEL_WHAT_YOU_LOSE_TITLE,subtitleText:j.Z.Messages.PREMIUM_CANCEL_WHAT_YOU_LOSE_SUBTITLE.format(),footer:(0,
r.jsxs)("div",{className:k().whatYouLoseButtonContainer,children:[(0,r.jsx)(m.Co,{onClick:function(){return T(G.CONFIRM)},children:j.Z.Messages.CONTINUE}),(0,r.jsx)(m.Co,{look:m.Co.Looks.LINK,color:f===x.BRd.DARK?m.Co.Colors.WHITE:m.Co.Colors.PRIMARY,onClick:function(){return v(L)},children:j.Z.Messages.PREMIUM_CANCEL_WHAT_YOU_LOSE_BACK})]}),onClose:function(){return v(L)}});break;case G.CONFIRM:b=(0,r.jsx)(X,{premiumSubscription:n,premiumType:d,setStep:T,onClose:function(){return v(L)},whatYouLoseExperienceEnabled:C,analyticsLocation:u});break;case G.PREVIEW:b=(0,r.jsx)(q,{premiumSubscription:n,premiumType:d,onBack:function(){return T(G.CONFIRM)},onClose:function(){return v(L)},analyticsLocation:u});break;default:throw new Error("Unexpected step: ".concat(L))}return(0,r.jsx)(y,{children:(0,r.jsx)(N.Y0,{transitionState:s,children:b})})}function ne(e){h.default.track(x.rMx.OPEN_MODAL,{type:"Premium Churn Survey"});return(0,L.ZD)(Y((function(){var t,a;return V(this,(function(s){
switch(s.label){case 0:return[4,Promise.all([n.e(40532),n.e(57656)]).then(n.bind(n,657656))];case 1:t=s.sent(),a=t.default;return[2,function(t){return(0,r.jsx)(a,H({},t,e))}]}}))})))}},125313:(e,t,n)=>{n.d(t,{Z:()=>l});var r=n(785893),a=(n(667294),n(892472)),s=n(959797),o=n(241387),i=n.n(o);const l=function(e){var t=e.onClick;return(0,r.jsx)(a.Z,{onClick:t,className:i().link,children:s.Z.Messages.BACK})}},279480:(e,t,n)=>{n.d(t,{w:()=>p,H:()=>_});var r=n(667294),a=n(791462),s=n(992497),o=n(916957),i=n(922877),l=n(590483),u=n(609993),c=n(959797);function p(e,t,n){r.useEffect((function(){if(null!=e&&e.isPurchasedExternally&&null!=e.paymentGateway&&!n){s.Z.show({title:c.Z.Messages.BILLING_EXTERNAL_HEADER.format({paymentGatewayName:u.Vz[e.paymentGateway]}),body:c.Z.Messages.BILLING_EXTERNAL_MANAGE_ELSEWHERE.format({paymentGatewayName:u.Vz[e.paymentGateway],subscriptionManagementLink:(0,l.JE)(e.paymentGateway,"SUBSCRIPTION_MANAGEMENT")}),confirmText:c.Z.Messages.OKAY});t()}}),[e])}var E=[]
;function _(e,t){var n=(0,a.e7)([o.Z],(function(){return o.Z.get(e)})),s=(0,a.e7)([i.Z],(function(){var e;return null!=n&&null!==(e=i.Z.getForSku(n.skuId))&&void 0!==e?e:E})),u=r.useMemo((function(){return Array.from(s).filter((function(e){var t=e.parentId,n=e.consumed;return null!=t&&!n}))}),[s]);return{hasEntitlements:!t&&null!=n&&null!=u&&u.length>=l.ZP.getIntervalMonths(n.interval,n.intervalCount),entitlements:u}}}}]);
//# sourceMappingURL=9a923e4d475e7f648bf6.js.map